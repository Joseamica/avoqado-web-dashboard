# Internationalization (i18n)

Complete guide to the translation system using react-i18next with JSON-based namespaces.

## ⚠️ MANDATORY POLICY - NO EXCEPTIONS

**EVERY user-facing change requires complete i18n implementation.** This is not optional - it's a core requirement for ANY UI work.

When creating, modifying, or updating any user interface element, i18n support MUST be included before the task is considered complete.

## Core Requirements

1. **Use `react-i18next`** with `useTranslation()` and `t('...')` for every user-visible string
2. **Add translation keys** for ALL supported languages (en, es, fr)
3. **Use interpolation/pluralization** instead of string concatenation
4. **Map dynamic labels** (statuses, enums) to translation keys
5. **Format dates/numbers/currency** using locale-aware APIs
6. **Test in all languages** before considering work complete

### Task Completion Checklist

- [ ] **No hardcoded text**: All strings use `t('...')` - zero exceptions
- [ ] **Multilingual support**: Keys added for en, es, and fr
- [ ] **Quality translations**: Spanish and French versions are culturally appropriate
- [ ] **Dynamic content**: Interpolation/pluralization used instead of concatenation
- [ ] **Proper formatting**: Locale-aware display for dates/numbers/currency
- [ ] **User testing**: Interface verified in all languages
- [ ] **Clean enums**: No raw status/category codes displayed to users

**CRITICAL**: When asked to create ANY UI element (component, dialog, form, button), i18n implementation is automatically part of that request.

## Architecture

### Modern JSON-Based Structure

Translations are organized as **JSON files** in `src/locales/` with **namespace-based separation**:

```
src/
├── locales/
│   ├── en/
│   │   ├── common.json        # Shared strings (buttons, actions, validation)
│   │   ├── sidebar.json       # Navigation menu
│   │   ├── menu.json          # Menu management
│   │   ├── venue.json         # Venue configuration
│   │   ├── payment.json       # Payment providers
│   │   ├── inventory.json     # Inventory management
│   │   ├── settings.json      # Settings pages
│   │   ├── testing.json       # Testing features
│   │   └── superadmin.json    # Superadmin dashboard
│   ├── es/
│   │   └── ... (mirrors en/ structure)
│   └── fr/
│       └── ... (mirrors en/ structure)
└── i18n.ts                    # i18next configuration
```

### When to Use Namespaces

**Create separate namespace when:**
- Feature has 50+ translation keys
- Feature is self-contained (menu, venue, payment, inventory)
- Translations form logical hierarchy (page → sections → fields)

**Keep in common.json when:**
- Strings used across multiple features (buttons, validation, status labels)
- Fewer than 20 keys
- Generic UI components (dialogs, toasts, confirmations)

**Split large JSON files when:**
- Single JSON file exceeds 500 lines
- Multiple distinct sub-features exist

## Configuration

### i18n.ts Setup

**Location**: `src/i18n.ts`

```typescript
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'

// Import JSON files
import commonEn from '@/locales/en/common.json'
import commonEs from '@/locales/es/common.json'
import commonFr from '@/locales/fr/common.json'

import menuEn from '@/locales/en/menu.json'
import menuEs from '@/locales/es/menu.json'
import menuFr from '@/locales/fr/menu.json'

// Base namespace uses 'common' translations (not feature-specific)
const resources = {
  en: {
    translation: commonEn as Record<string, unknown>,
  },
  es: {
    translation: commonEs as Record<string, unknown>,
  },
  fr: {
    translation: commonFr as Record<string, unknown>,
  },
}

i18n
  .use(simpleDetector)
  .use(initReactI18next)
  .init({
    resources,
    fallbackLng: 'en',
    supportedLngs: ['en', 'es', 'fr'],
    interpolation: {
      escapeValue: false,
    },
  })

// Register feature-specific namespaces
;([
  ['en', menuEn],
  ['es', menuEs],
  ['fr', menuFr],
] as const).forEach(([lng, bundle]) => {
  i18n.addResourceBundle(lng, 'menu', bundle as Record<string, unknown>, true, true)
})

// Repeat for other namespaces
```

### Critical Rules

**❌ WRONG - Base namespace using feature translations:**
```typescript
const resources = {
  en: {
    translation: superadminEn,  // ❌ Only superadmin strings available globally!
  },
}
```

**✅ CORRECT - Base namespace using common translations:**
```typescript
const resources = {
  en: {
    translation: commonEn,  // ✅ Common strings available everywhere
  },
}

// Then register superadmin as separate namespace
i18n.addResourceBundle('en', 'superadmin', superadminEn, true, true)
```

## Usage Patterns

### Using Default Namespace (common)

```typescript
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t } = useTranslation()  // Uses 'translation' (common.json)

  return (
    <div>
      <button>{t('save')}</button>        {/* "Save" */}
      <button>{t('cancel')}</button>      {/* "Cancel" */}
      <p>{t('optional')}</p>              {/* "Optional" */}
    </div>
  )
}
```

### Using Feature Namespace

```typescript
import { useTranslation } from 'react-i18next'

function MenuPage() {
  const { t } = useTranslation('menu')  // Uses menu.json namespace

  return (
    <div>
      <h1>{t('overview.title')}</h1>           {/* "Menu Overview" */}
      <button>{t('categories.addButton')}</button>  {/* "Add Category" */}
    </div>
  )
}
```

### Using Multiple Namespaces

```typescript
import { useTranslation } from 'react-i18next'

function ComplexComponent() {
  const { t } = useTranslation(['menu', 'common'])  // Array of namespaces

  return (
    <div>
      {/* Explicit namespace prefix */}
      <h1>{t('menu:overview.title')}</h1>     {/* "Menu Overview" */}
      <button>{t('common:save')}</button>     {/* "Save" */}

      {/* Implicit - uses first namespace (menu) */}
      <p>{t('overview.subtitle')}</p>         {/* "Manage products..." */}
    </div>
  )
}
```

## Translation Structure

### common.json (Shared Strings)

```json
{
  "cancel": "Cancel",
  "save": "Save",
  "saving": "Saving...",
  "delete": "Delete",
  "deleting": "Deleting...",
  "success": "Success",
  "error": "Error",
  "optional": "Optional",
  "none": "None",
  "loading": "Loading...",
  "search": "Search",
  "filter": "Filter",
  "export": "Export",
  "import": "Import",
  "close": "Close",
  "confirm": "Confirm",
  "back": "Back",
  "next": "Next",
  "previous": "Previous",
  "finish": "Finish"
}
```

### Feature Namespace (Hierarchical Structure)

```json
{
  "featureName": {
    // Page/section level
    "title": "Feature Title",
    "subtitle": "Feature description",

    // Table columns
    "columns": {
      "name": "Name",
      "status": "Status",
      "actions": "Actions",
      "createdAt": "Created",
      "updatedAt": "Updated"
    },

    // Status/enum mappings
    "status": {
      "active": "Active",
      "inactive": "Inactive",
      "pending": "Pending",
      "completed": "Completed"
    },

    // User feedback (toasts)
    "toasts": {
      "success": "Success",
      "createSuccess": "Created successfully",
      "updateSuccess": "Updated successfully",
      "deleteSuccess": "Deleted successfully",
      "error": "Error",
      "createError": "Failed to create",
      "updateError": "Failed to update",
      "deleteError": "Failed to delete"
    },

    // Confirmation dialogs
    "confirmations": {
      "delete": "Are you sure you want to delete this item?",
      "deactivate": "Are you sure you want to deactivate this item?",
      "unsavedChanges": "You have unsaved changes. Are you sure you want to leave?"
    },

    // Forms
    "form": {
      "fields": {
        "name": "Name",
        "description": "Description",
        "price": "Price",
        "quantity": "Quantity"
      },
      "placeholders": {
        "name": "Enter name...",
        "description": "Enter description...",
        "search": "Search..."
      },
      "validation": {
        "nameRequired": "Name is required",
        "pricePositive": "Price must be positive",
        "emailInvalid": "Invalid email address"
      }
    }
  }
}
```

## Advanced Features

### Interpolation

**Use interpolation for dynamic content:**

```typescript
// Translation
{
  "greeting": "Hello, {{name}}!",
  "itemCount": "You have {{count}} items"
}

// Usage
t('greeting', { name: 'Alice' })        // "Hello, Alice!"
t('itemCount', { count: 5 })            // "You have 5 items"
```

**Complex interpolation:**
```typescript
// Translation
{
  "revenue": "Total revenue: {{amount, currency}}"
}

// Usage
t('revenue', { amount: 1234.56 })       // "Total revenue: $1,234.56"
```

### Pluralization

**Handle singular/plural forms:**

```typescript
// Translation
{
  "products_one": "{{count}} product",
  "products_other": "{{count}} products"
}

// Usage
t('products', { count: 1 })             // "1 product"
t('products', { count: 5 })             // "5 products"
```

### Date Formatting

**Use locale-aware date formatting:**

```typescript
import { format } from 'date-fns'
import { enUS, es, fr } from 'date-fns/locale'
import { useTranslation } from 'react-i18next'

function formatDate(date: Date) {
  const { i18n } = useTranslation()

  const localeMap = {
    en: enUS,
    es: es,
    fr: fr,
  }

  return format(date, 'PPP', {
    locale: localeMap[i18n.language as keyof typeof localeMap],
  })
}

// Usage
formatDate(new Date())
// en: "October 29, 2025"
// es: "29 de octubre de 2025"
// fr: "29 octobre 2025"
```

### Number/Currency Formatting

**Use Intl.NumberFormat for locale-aware numbers:**

```typescript
import { useTranslation } from 'react-i18next'

function formatCurrency(amount: number) {
  const { i18n } = useTranslation()

  return new Intl.NumberFormat(i18n.language, {
    style: 'currency',
    currency: 'USD',
  }).format(amount)
}

// Usage
formatCurrency(1234.56)
// en: "$1,234.56"
// es: "1.234,56 US$"
// fr: "1 234,56 $US"
```

## Best Practices

### 1. Always Use Translation Keys

**❌ WRONG:**
```typescript
<h1>Menu Overview</h1>
<button>Add Product</button>
```

**✅ CORRECT:**
```typescript
const { t } = useTranslation('menu')

<h1>{t('overview.title')}</h1>
<button>{t('products.addButton')}</button>
```

### 2. Map Enums to Translation Keys

**❌ WRONG:**
```typescript
<Badge>{order.status}</Badge>  // Shows "PENDING"
```

**✅ CORRECT:**
```typescript
const { t } = useTranslation('orders')

<Badge>{t(`status.${order.status}`)}</Badge>  // Shows "Pending"
```

### 3. Use Interpolation, Not Concatenation

**❌ WRONG:**
```typescript
const message = "Welcome back, " + user.name + "!"
```

**✅ CORRECT:**
```typescript
const message = t('greeting', { name: user.name })
```

### 4. Document Interpolation Variables

```json
{
  "greeting": "Welcome back, {{name}}!",
  "_greetingComment": "{{name}} = User's first name"
}
```

### 5. Organize by UI Hierarchy

```json
{
  "menu": {
    "overview": {
      "title": "...",
      "subtitle": "..."
    },
    "categories": {
      "title": "...",
      "addButton": "..."
    }
  }
}
```

### 6. Keep Keys Descriptive

**❌ WRONG:**
```json
{
  "btn1": "Save",
  "msg1": "Success"
}
```

**✅ CORRECT:**
```json
{
  "saveButton": "Save",
  "successMessage": "Saved successfully"
}
```

## Common Pitfalls

### Pitfall #1: Hardcoded Strings

**❌ WRONG:**
```typescript
toast({ title: "Product created successfully" })
```

**✅ CORRECT:**
```typescript
const { t } = useTranslation('menu')
toast({ title: t('toasts.createSuccess') })
```

### Pitfall #2: Missing Translations

**Symptom**: UI shows translation keys instead of text (`menu.overview.title`)

**Cause**: Key missing in JSON file

**Fix**: Add key to all language files (en, es, fr)

### Pitfall #3: Mixing Namespaces in Base Translation

**❌ WRONG:**
```typescript
const resources = {
  en: {
    translation: { ...commonEn, ...menuEn, ...venueEn }  // Don't merge!
  }
}
```

**✅ CORRECT:**
```typescript
const resources = {
  en: { translation: commonEn }  // Only common
}
i18n.addResourceBundle('en', 'menu', menuEn)
i18n.addResourceBundle('en', 'venue', venueEn)
```

### Pitfall #4: Wrong Namespace

**❌ WRONG:**
```typescript
const { t } = useTranslation()  // Uses 'translation' (common)
return <h1>{t('menu.overview.title')}</h1>  // Key not found!
```

**✅ CORRECT:**
```typescript
const { t } = useTranslation('menu')  // Uses menu namespace
return <h1>{t('overview.title')}</h1>  // Works!
```

## Adding New Translations

### Step-by-Step Guide

**1. Identify all user-facing strings:**
```typescript
// Before
function ProductForm() {
  return (
    <div>
      <h2>Create Product</h2>
      <label>Name</label>
      <input placeholder="Enter product name..." />
      <button>Save Product</button>
    </div>
  )
}
```

**2. Create translation structure:**
```json
// src/locales/en/menu.json
{
  "products": {
    "createTitle": "Create Product",
    "form": {
      "fields": {
        "name": "Name"
      },
      "placeholders": {
        "name": "Enter product name..."
      }
    },
    "saveButton": "Save Product"
  }
}
```

**3. Add Spanish translations:**
```json
// src/locales/es/menu.json
{
  "products": {
    "createTitle": "Crear Producto",
    "form": {
      "fields": {
        "name": "Nombre"
      },
      "placeholders": {
        "name": "Ingrese el nombre del producto..."
      }
    },
    "saveButton": "Guardar Producto"
  }
}
```

**4. Add French translations:**
```json
// src/locales/fr/menu.json
{
  "products": {
    "createTitle": "Créer un produit",
    "form": {
      "fields": {
        "name": "Nom"
      },
      "placeholders": {
        "name": "Entrez le nom du produit..."
      }
    },
    "saveButton": "Enregistrer le produit"
  }
}
```

**5. Update component:**
```typescript
// After
import { useTranslation } from 'react-i18next'

function ProductForm() {
  const { t } = useTranslation('menu')

  return (
    <div>
      <h2>{t('products.createTitle')}</h2>
      <label>{t('products.form.fields.name')}</label>
      <input placeholder={t('products.form.placeholders.name')} />
      <button>{t('products.saveButton')}</button>
    </div>
  )
}
```

**6. Test in all languages:**
- Switch language in UI
- Verify all strings display correctly
- Check for layout issues (Spanish/French text often longer than English)

## Migration Checklist

When converting a component to use namespace translations:

1. [ ] **Read component** - Identify all hardcoded strings
2. [ ] **Create namespace structure** - Organize by UI section
3. [ ] **Add English translations** - Complete key structure
4. [ ] **Add Spanish translations** - Verify quality
5. [ ] **Add French translations** - Verify quality
6. [ ] **Register namespace** - Add `i18n.addResourceBundle()` calls
7. [ ] **Update component** - Change `useTranslation()` to use namespace
8. [ ] **Update translation keys** - Remove namespace prefix from `t()` calls
9. [ ] **Test in all languages** - Verify display in en, es, fr
10. [ ] **Build verification** - Run `npm run build` to catch errors

## Language Selector

**Location**: `src/components/language-switcher.tsx`

**DO NOT duplicate this component.** Use the existing language selector in the app.

**Usage:**
- Dropdown in user menu
- Switches between en, es, fr
- Persists selection to localStorage
- Updates all components automatically

## File Size Guidelines

**Target sizes:**
- `common.json`: < 50 keys (shared essentials only)
- Feature namespaces: 50-300 keys
- Large features: Split into sub-namespaces if > 500 keys

**Example refactoring:**
```
Before: superadmin.json (2,855 lines)
After:
  ├── common.json (14 lines)
  ├── superadmin/home.json (200 lines)
  ├── superadmin/analytics.json (150 lines)
  └── superadmin/profitAnalytics.json (180 lines)
```

## Benefits of JSON-Based Architecture

- **Editor support**: JSON validation, autocomplete, and formatting
- **Version control**: Easier diffs and merge conflict resolution
- **Translation tools**: Compatible with Crowdin, Lokalise, POEditor
- **Type safety**: Can generate TypeScript types from JSON schemas
- **Smaller bundles**: Tree-shaking potential with dynamic imports
- **CI/CD checks**: Automated validation of missing keys across languages
- **Team collaboration**: Translators can work directly in JSON files

## Related Documentation

- [Architecture Overview](../architecture/overview.md) - Component patterns
- [Theme Guide](./theme.md) - UI styling
- [Inventory Guide](./inventory.md) - Example of namespace usage
